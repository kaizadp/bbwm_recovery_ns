geom_line(aes(y = so4_v*10),color="black",size=0.6)+
geom_point(aes(y = so4_v*10))+
scale_y_continuous(sec.axis = sec_axis(~./10, name = "conc"))+
ylab("flux")+
scale_fill_brewer(palette = "Dark2")+
#scale_fill_manual(values = c("#6f8ea9","#003b8f"))+
#scale_fill_manual(values = c("#d9d9d9","#D95F02"))+
geom_vline(xintercept = 1989.5,linetype="dashed")+
geom_vline(xintercept = 2016.5,linetype="dashed")+
annotate("text", label = "pre-treatment", x = 1988, y = 2500, angle = 90,size=4, hjust = "right")+
annotate("text", label = "recovery", x = 2017.5, y = 2500, angle = 90,size=4, hjust = "right")+
theme_kp()
ggplot(annual2, aes(x = WY, fill = Watershed,shape=Watershed))+
geom_bar(aes(y = no3),stat = "identity")+
geom_line(aes(y = no3_v*10),color="black",size=0.6)+
geom_point(aes(y = no3_v*10))+
scale_y_continuous(sec.axis = sec_axis(~./10, name = "conc"))+
ylab("flux")+
#scale_fill_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#bebebe","#D95F02"))+
geom_hline(yintercept = 0,size=2)+
geom_vline(xintercept = 1989.5,linetype="dashed")+
geom_vline(xintercept = 2016.5,linetype="dashed")+
annotate("text", label = "pre-treatment", x = 1988, y = 650, angle = 90,size=4, hjust = "right")+
annotate("text", label = "recovery", x = 2017.5, y = 650, angle = 90,size=4, hjust = "right")+
theme_kp()
ggplot(annual2, aes(x = WY, fill = Watershed, shape = Watershed))+
geom_bar(aes(y = so4),stat = "identity", alpha = 0.9)+
geom_line(aes(y = so4_v*10),color="black",size=0.6)+
geom_point(aes(y = so4_v*10))+
scale_y_continuous(sec.axis = sec_axis(~./10, name = "conc"))+
ylab("flux")+
scale_fill_brewer(palette = "Dark2")+
#scale_fill_manual(values = c("#6f8ea9","#003b8f"))+
#scale_fill_manual(values = c("#d9d9d9","#D95F02"))+
geom_vline(xintercept = 1989.5,linetype="dashed")+
geom_vline(xintercept = 2016.5,linetype="dashed")+
annotate("text", label = "pre-treatment", x = 1988, y = 2500, angle = 90,size=4, hjust = "right")+
annotate("text", label = "recovery", x = 2017.5, y = 2500, angle = 90,size=4, hjust = "right")+
theme_kp()
ggplot(annual2, aes(x = WY, fill = Watershed,shape=Watershed))+
geom_bar(aes(y = no3),stat = "identity")+
geom_line(aes(y = no3_v*10),color="black",size=0.6)+
geom_point(aes(y = no3_v*10))+
scale_y_continuous(sec.axis = sec_axis(~./10, name = "conc"))+
ylab("flux")+
#scale_fill_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#bebebe","#D95F02"))+
geom_hline(yintercept = 0,size=1)+
geom_vline(xintercept = 1989.5,linetype="dashed")+
geom_vline(xintercept = 2016.5,linetype="dashed")+
annotate("text", label = "pre-treatment", x = 1988, y = 650, angle = 90,size=4, hjust = "right")+
annotate("text", label = "recovery", x = 2017.5, y = 650, angle = 90,size=4, hjust = "right")+
theme_kp()
ggplot(annual2, aes(x = WY, fill = Watershed,shape=Watershed))+
geom_bar(aes(y = no3),stat = "identity")+
geom_line(aes(y = no3_v*10),color="black",size=0.6)+
geom_point(aes(y = no3_v*10))+
scale_y_continuous(sec.axis = sec_axis(~./10, name = "conc"))+
ylab("flux")+
#scale_fill_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#bebebe","#D95F02"))+
geom_hline(yintercept = 0,size=0.5)+
geom_vline(xintercept = 1989.5,linetype="dashed")+
geom_vline(xintercept = 2016.5,linetype="dashed")+
annotate("text", label = "pre-treatment", x = 1988, y = 650, angle = 90,size=4, hjust = "right")+
annotate("text", label = "recovery", x = 2017.5, y = 650, angle = 90,size=4, hjust = "right")+
theme_kp()
ggplot(annual2, aes(x = WY, fill = Watershed,shape=Watershed))+
geom_bar(aes(y = no3),stat = "identity")+
geom_line(aes(y = no3_v*10),color="black",size=0.6)+
geom_point(aes(y = no3_v*10))+
scale_y_continuous(sec.axis = sec_axis(~./10, name = "conc"))+
ylab("flux")+
#scale_fill_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#bebebe","#D95F02"))+
geom_hline(yintercept = 0,size=0.3)+
geom_vline(xintercept = 1989.5,linetype="dashed")+
geom_vline(xintercept = 2016.5,linetype="dashed")+
annotate("text", label = "pre-treatment", x = 1988, y = 650, angle = 90,size=4, hjust = "right")+
annotate("text", label = "recovery", x = 2017.5, y = 650, angle = 90,size=4, hjust = "right")+
theme_kp()
all %>%
dplyr::filter(Year>2014) %>%
dplyr::mutate(date2 = as.Date(paste(Year,Month,Day, sep = "-")))->temp
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
all %>%
dplyr::filter(Year>2013) %>%
dplyr::mutate(date2 = as.Date(paste(Year,Month,Day, sep = "-")))->temp
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
all %>%
dplyr::filter(Year>2014) %>%
dplyr::mutate(date2 = as.Date(paste(Year,Month,Day, sep = "-")))->temp
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
all %>%
dplyr::filter(Year>2015) %>%
dplyr::mutate(date2 = as.Date(paste(Year,Month,Day, sep = "-")))->temp
ggplot(temp,aes(x = date2, y = SO4, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
ylim(0,200)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(all,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(all,aes(x = date, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(all,aes(x = dates, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
all %>%
#dplyr::filter(Year>2015) %>%
dplyr::mutate(date2 = as.Date(paste(Year,Month,Day, sep = "-")))->temp
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
all %>%
dplyr::filter(Year>2015) %>%
dplyr::mutate(date2 = as.Date(paste(Year,Month,Day, sep = "-")))->temp
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
geom_smooth()+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
geom_smooth()+
geom_spline()+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
geom_line(data=data.frame(spline(temp, n=n*10)))+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
geom_line(data=data.frame(spline(temp)))+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 3), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 3), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 5), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 1), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 10), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 8), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 5), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 6), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 7), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 8), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 15), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 25), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 50), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
# geom_path(size=1)+
geom_smooth(method = lm, formula = y ~ splines::bs(x, 40), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
geom_path(size=1)+
# geom_smooth(method = lm, formula = y ~ splines::bs(x, 40), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(temp,aes(x = date2, y = NO3, color = Watershed,shape=Watershed))+
geom_point(size=2,stroke=1.5)+
#  geom_path(size=1)+
# geom_smooth(method = lm, formula = y ~ splines::bs(x, 40), se = FALSE)+
scale_shape_manual(values = c(1,16))+
#ylim(0,15)+
geom_vline(xintercept = unclass(as.Date("2016-11-01")),linetype = "longdash")+
theme_kp()+
scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
bbwm_all = read_csv("data/bbwm_all.csv") ## concentrations
source("0-bbwm_packages.R")
bbwm_all = read_csv("data/bbwm_all.csv") ## concentrations
# create subset with select columns
bbwm_all %>%
dplyr::select(Watershed,Year,WY,Month,Day,`NO3 (ueq/L)`,
`SO4 (ueq/L)`,`DOC (mg/L)`,`Discharge (L/sec)`,`Specific Conductance (us/cm)`,`ANC (ueq/L)`) %>%
dplyr::filter(Watershed %in% c("EB","WB")) %>%
dplyr::rename(NO3 = `NO3 (ueq/L)`,
SO4 = `SO4 (ueq/L)`,
DOC = `DOC (mg/L)`,
Q = `Discharge (L/sec)`,
ANC = `ANC (ueq/L)`) %>%
dplyr::mutate(dates = as.Date(paste(Year, Month, Day,sep="-")))->
all
# STEP 5: exporting ALL and ANNUAL ----
write.csv(all,"processed/concentrations.csv", row.names = FALSE)
bbwm_all = read_csv("data/bbwm_all.csv") ## concentrations
bbwm_all = read.csv("data/bbwm_all.csv") ## concentrations
# create subset with select columns
bbwm_all %>%
dplyr::select(Watershed,Year,WY,Month,Day,`NO3 (ueq/L)`,
`SO4 (ueq/L)`,`DOC (mg/L)`,`Discharge (L/sec)`,`Specific Conductance (us/cm)`,`ANC (ueq/L)`) %>%
dplyr::filter(Watershed %in% c("EB","WB")) %>%
dplyr::rename(NO3 = `NO3 (ueq/L)`,
SO4 = `SO4 (ueq/L)`,
DOC = `DOC (mg/L)`,
Q = `Discharge (L/sec)`,
ANC = `ANC (ueq/L)`) %>%
dplyr::mutate(dates = as.Date(paste(Year, Month, Day,sep="-")))->
all
bbwm_all = read_csv("data/bbwm_all.csv") ## concentrations
# create subset with select columns
bbwm_all %>%
dplyr::select(Watershed,Year,WY,Month,Day,`NO3 (ueq/L)`,
`SO4 (ueq/L)`,`DOC (mg/L)`,`Discharge (L/sec)`,`Specific Conductance (us/cm)`,`ANC (ueq/L)`) %>%
dplyr::filter(Watershed %in% c("EB","WB")) %>%
dplyr::rename(NO3 = `NO3 (ueq/L)`,
SO4 = `SO4 (ueq/L)`,
DOC = `DOC (mg/L)`,
Q = `Discharge (L/sec)`,
ANC = `ANC (ueq/L)`) %>%
dplyr::mutate(dates = as.Date(paste(Year, Month, Day,sep="-")))->
all
# STEP 5: exporting ALL and ANNUAL ----
write.csv(all,"processed/concentrations.csv", row.names = FALSE)
bbwm_all = read_csv("data/bbwm_all.csv") ## concentrations
# create subset with select columns
bbwm_all %>%
dplyr::select(Watershed,Year,WY,Month,Day,`NO3 (ueq/L)`,
`SO4 (ueq/L)`,`DOC (mg/L)`,`Discharge (L/sec)`,`Specific Conductance (us/cm)`,`ANC (ueq/L)`) %>%
dplyr::filter(Watershed %in% c("EB","WB")) %>%
dplyr::rename(NO3 = `NO3 (ueq/L)`,
SO4 = `SO4 (ueq/L)`,
DOC = `DOC (mg/L)`,
Q = `Discharge (L/sec)`,
ANC = `ANC (ueq/L)`) %>%
dplyr::mutate(dates = as.Date(paste(Year, Month, Day,sep="-")))->
all
# STEP 5: exporting ALL and ANNUAL ----
write.csv(all,"processed/concentrations.csv", row.names = FALSE)
library(drake)
source("0-bbwm_packages.R")
plan = drake_plan(
#
# STEP 1: load files -------------------- # ----
bbwm_annual = read.csv ("data/bbwm_annual.csv"), ## fluxes
bbwm_all = read_csv("data/bbwm_all.csv"), ## concentrations
# STEP 2: process annual flux data ----
# create subset with select columns
annual =
bbwm_annual %>%
dplyr::select(WY,Watershed,Area,H2O,DOC,NO3,SO4,ANC,`Discharge.L.s`,EQPH) %>%
dplyr::rename(Q = `Discharge.L.s`) %>%
dplyr::mutate(Watershed = factor(Watershed, levels = c("EB","WB")),
# create columns to group by year/period
WY_group = case_when(WY <1990 ~"1989",
(WY>1989 & WY <2000) ~ "1990-99",
(WY>1999 & WY <2010) ~ "2000-09",
(WY>2009 & WY <2017) ~ "2010-16",
(WY>2016) ~ "2017-18"),
period = case_when(WY<1990 ~ "pre-treatment",
(WY>1989 & WY <2000)~ "first decade",
(WY>1999 & WY <2010)~ "second decade",
(WY>2009 & WY <2017)~ "third decade",
(WY>2016)~ "recovery"),
WY_group = factor(WY_group,
levels=c("1989","1990-99","2000-09","2010-16","2017-18")),
period = factor(period,
levels=c("pre-treatment","first decade","second decade","third decade","recovery")),
# create columns for volume-weighted
NO3_vol = round(NO3/(H2O/Area),2),
SO4_vol = round(SO4/(H2O/Area),2),
DOC_vol = round(DOC/(H2O/Area),2)),
# STEP 3: process concentrations dataset ----
# create subset with select columns
all =
bbwm_all %>%
dplyr::select(Watershed,Year,WY,Month,Day,`NO3 (ueq/L)`,
`SO4 (ueq/L)`,`DOC (mg/L)`,`Discharge (L/sec)`,`Specific Conductance (us/cm)`,`ANC (ueq/L)`) %>%
dplyr::filter(Watershed %in% c("EB","WB")) %>%
dplyr::rename(NO3 = `NO3 (ueq/L)`,
SO4 = `SO4 (ueq/L)`,
DOC = `DOC (mg/L)`,
Q = `Discharge (L/sec)`,
ANC = `ANC (ueq/L)`) %>%
dplyr::mutate(dates = as.Date(paste(Year, Month, Day,sep="-"))),
# STEP 4: annual flux summary table -------------------- # ----
summary = annual %>%
dplyr::select(Watershed,period,NO3,SO4) %>%
gather(species,flux,NO3:SO4) %>%
group_by(Watershed,period,species) %>%
dplyr::summarise(mean = mean(flux),
se = sd(flux)/sqrt(n())) %>%
dplyr::mutate(summary = paste(round(mean,2),"\u00B1",round(se,2))),
# STEP 5: exporting ALL and ANNUAL ----
write.csv(all,"processed/concentrations.csv", row.names = FALSE),
write.csv(annual,"processed/fluxes.csv", row.names = FALSE),
write.csv(summary,"processed/summary.csv", row.names = FALSE)
)
make(plan)
