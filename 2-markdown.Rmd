---
title: "BBWM initial recovery"
author: "Kaizad Patel"
output: html_document
---

`r Sys.Date()`

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE,message=FALSE,warning=FALSE,
                      collapse = TRUE,
                      comment = "#>",
                      fig.path = "images/"
                      )

source("0-bbwm_packages.R")

all = read.csv("processed/concentrations.csv")
annual = read.csv("processed/fluxes.csv")
summary = read.csv("processed/summary.csv")

```


## nitrate

```{r nitrate}
#nitrate
ggplot (na.omit(annual), 
                     aes(x = WY, y = NO3_vol,color = Watershed,fill=Watershed,shape = Watershed,linetype=Watershed))+
  geom_point(data=all,
             aes(x = WY, y = NO3, color = "grey"))+
  geom_smooth(alpha = 0.2)+
  geom_point(size=3,stroke=1.5)+
  scale_color_got(discrete=TRUE,option = "tully")+
  scale_fill_got(discrete=TRUE,option = "tully")+
  scale_shape_manual(values = c(4,19))+
  
  geom_vline(xintercept = 1989.2,linetype="dashed")+
  geom_vline(xintercept = 2016.5,linetype="dashed")+
  annotate("text", label = "pre-treatment", x = 1988, y = 80, angle = 90,size=4, hjust = "right")+ 
  annotate("text", label = "recovery", x = 2017.5, y = 80, angle = 90,size=4, hjust = "right")+ 
  
  labs (y = expression (bold ("NO"[3]^-{}* " ("*mu*"eq L"^-1*")")),
        x = expression (bold ("WY")))+

  theme_kp()+
  theme (legend.position = "none")
```




# sulfate


```{r}

annual_sulf = ggplot (na.omit(annual), 
                      aes(x = WY, y = SO4_vol,color = Watershed,fill=Watershed,shape = Watershed,linetype=Watershed))+
  geom_point(data=all,
             aes(x = WY, y = SO4, color = "grey"))+
  geom_smooth(alpha = 0.2)+
  geom_point(size=3,stroke=1.5)+
  scale_color_got(discrete=TRUE,option = "tully")+
  scale_fill_got(discrete=TRUE,option = "tully")+
  scale_shape_manual(values = c(4,19))+
  
  geom_vline(xintercept = 1989.2,linetype="dashed")+
  geom_vline(xintercept = 2016.5,linetype="dashed")+
  annotate("text", label = "pre-treatment", x = 1988, y = 200, angle = 90,size=4, hjust = "right")+ 
  annotate("text", label = "recovery", x = 2017.5, y = 200, angle = 90,size=4, hjust = "right")+ 
  
  labs (y = expression (bold ("SO"[4]^-2* " ("*mu*"eq L"^-1*")")),
        x = expression (bold ("WY")))+
  
  theme_bw()+
  theme (legend.position = "none")+
  theme (legend.key = element_rect(size = 3))+
  theme (legend.title = element_blank())+
  theme (legend.text=element_text(size=14))+
  theme (legend.key = element_rect(size = 5),
         legend.key.size = unit(2, 'lines'))+
  theme (plot.title = element_text(hjust = 0.05,size = 14))+
  theme (axis.text=element_text(size=14,face="bold",color="black"),
         axis.title=element_text(size=14,face="bold",color="black")); annual_sulf
```



# DOC


```{r}


annual_DOC=ggplot (na.omit(annual), aes(x = WY, y = DOC_vol,color = Watershed,shape = Watershed,linetype=Watershed))+
  geom_point(data=all,
             aes(x = WY, y = DOC, color = "grey"))+
  geom_smooth(color = "grey",alpha = 0.2)+
  geom_point(size=3,stroke=1.5)+
  scale_color_got(discrete=TRUE,option = "tully")+
  scale_shape_manual(values = c(1,19))+
  
  geom_vline(xintercept = 1989.2,linetype="dashed")+
  geom_vline(xintercept = 2016.5,linetype="dashed")+
  annotate("text", label = "pre-treatment", x = 1988, y = 250, angle = 90,size=4, hjust = "right")+ 
  annotate("text", label = "recovery", x = 2017.5, y = 250, angle = 90,size=4, hjust = "right")+ 
  
  labs (y = expression (bold ("DOC ("*mu*"mol L"^-1*")")),
        x = expression (bold ("WY")))+
  
  theme_bw()+
  theme (legend.position = "none")+
  theme (legend.key = element_rect(size = 3))+
  theme (legend.title = element_blank())+
  theme (legend.text=element_text(size=14))+
  theme (legend.key = element_rect(size = 5),
         legend.key.size = unit(2, 'lines'))+
  theme (plot.title = element_text(hjust = 0.05,size = 14))+
  theme (axis.text=element_text(size=14,face="bold",color="black"),
         axis.title=element_text(size=14,face="bold",color="black"));annual_DOC
```



# ANC


```{r}



annual_anc = ggplot (na.omit(annual), 
                     aes(x = WY, y = ANC,color = Watershed,shape = Watershed,linetype=Watershed))+
   geom_smooth(color = "grey",alpha = 0.2)+
  geom_point(size=3,stroke=1.5)+
  scale_color_got(discrete=TRUE,option = "tully")+
  scale_shape_manual(values = c(1,19))+
  
  geom_vline(xintercept = 1989.2,linetype="dashed")+
  geom_vline(xintercept = 2016.5,linetype="dashed")+
  annotate("text", label = "pre-treatment", x = 1988, y = 200, angle = 90,size=4, hjust = "right")+ 
  annotate("text", label = "recovery", x = 2017.5, y = 200, angle = 90,size=4, hjust = "right")+ 
  
  labs (y = expression (bold ("ANC"),
                        x = expression (bold ("WY"))))+
  
  theme_bw()+
  theme (legend.position = "none")+
  theme (legend.key = element_rect(size = 3))+
  theme (legend.title = element_blank())+
  theme (legend.text=element_text(size=14))+
  theme (legend.key = element_rect(size = 5),
         legend.key.size = unit(2, 'lines'))+
  theme (plot.title = element_text(hjust = 0.05,size = 14))+
  theme (axis.text=element_text(size=14,face="bold",color="black"),
         axis.title=element_text(size=14,face="bold",color="black")); annual_anc
```



# pH


```{r}


annual_pH = ggplot (na.omit(annual), aes(x = WY, y = EQPH,color = Watershed,shape = Watershed,linetype=Watershed))+
  geom_smooth(color = "grey",alpha = 0.2)+
  geom_point(size=3,stroke=1.5)+
  scale_color_got(discrete=TRUE,option = "tully")+
  scale_shape_manual(values = c(1,19))+
  
  geom_vline(xintercept = 1989.2,linetype="dashed")+
  geom_vline(xintercept = 2016.5,linetype="dashed")+
  annotate("text", label = "pre-treatment", x = 1988, y = 7, angle = 90,size=4, hjust = "right")+ 
  annotate("text", label = "recovery", x = 2017.5, y = 7, angle = 90,size=4, hjust = "right")+ 
  
  labs (y = expression (bold ("Air-equilibrated pH"),
                        x = expression (bold ("WY"))))+

  theme_bw()+
  theme (legend.position = c(0.2,0.8))+
  theme (legend.key = element_rect(size = 3))+
  theme (legend.title = element_blank())+
  theme (legend.text=element_text(size=14))+
  theme (legend.key = element_rect(size = 5),
         legend.key.size = unit(2, 'lines'))+
  theme (plot.title = element_text(hjust = 0.05,size = 14))+
  theme (axis.text=element_text(size=14,face="bold",color="black"),
         axis.title=element_text(size=14,face="bold",color="black")); annual_pH


```




# summary table

```{r}
summary %>% 
  dplyr::select(species,Watershed,period,summary) %>% 
  dplyr::mutate(period = factor(period, levels = c("pre-treatment","first decade","second decade","third decade","recovery"))) %>% 
  spread(period,summary) %>% 
    knitr::kable(align = "r")
```


```{r}
all %>% 
  dplyr::filter(Year>2015) %>% 
  dplyr::mutate(date2 = as.Date(paste(Year,Month,Day, sep = "-")))->temp



ggplot(temp,aes(x = date2, y = NO3, color = Watershed))+
  geom_point()+
  ylim(0,15)+
  theme_kp()+
  scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

ggplot(temp,aes(x = date2, y = SO4, color = Watershed))+
  geom_point()+
  theme_kp()+
  scale_x_date(date_breaks = "4 months", date_labels =  "%b %Y") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

